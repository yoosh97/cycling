<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1, user-scalable=no"/>
  <title>GPX ëª¨ë°”ì¼ ë¶„ì„ê¸°</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    :root { --gap: 12px; --radius: 14px; --brand: #12b886; --ink: #222; --muted:#666; --bg-soft:#f8f9fa; --line:#e9ecef; }
    *{box-sizing:border-box} html,body{height:100%;background:#fff;color:var(--ink)}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Apple SD Gothic Neo","Noto Sans KR",system-ui,sans-serif}
    header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--line);padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:8px}
    header > div {
      display: flex;
      justify-content: space-between;
      gap: 70px;
    }
    header p {
      font-size: 14px;
    }
    header h1{font-size:24px;margin:0} 
    header .btn{width: 180px; padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:var(--bg-soft)}
    .container{padding:12px 16px 120px}
    .toolbar{display:flex;gap:8px;align-items:center}
    .file-input{flex:1;min-width:160px;padding:10px;border:1px dashed var(--line);border-radius:var(--radius);background:#fff}
    .btn{padding:12px 16px;border:1px solid var(--line);border-radius:var(--radius);background:#fff;font-size:16px}
    .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)} .btn.ghost{background:var(--bg-soft)} .btn.danger{background:#f03e3e;color:#fff;border-color:#f03e3e}
    .muted{color:var(--muted);font-size:13px}
    #fileChips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{display:flex;align-items:center;gap:6px;padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;max-width:100%;box-shadow:0 1px 1px rgba(0,0,0,.04);font-size:14px}
    .chip span{max-width:56vw;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .chip button{padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#fff}

    #map{height:44vh;min-height:320px;border-radius:var(--radius);overflow:hidden;border:1px solid var(--line)}
    .map-toolbar{display:flex;gap:8px;margin-top:8px}

    table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px}
    th,td{border:1px solid var(--line);padding:10px;text-align:right}
    th{background:#fafafa;position:sticky;top:54px;z-index:5}
    td.left,th.left{text-align:left}
    tr.total-row{background:#eef8ff;font-weight:600}

    /* ê·¸ë˜í”„ ì¹´ë“œ */
    .card {
      margin-top:16px; border:1px solid var(--line); border-radius:16px; padding:12px;
      background:#fff; box-shadow:0 4px 16px rgba(0,0,0,.04);
    }
    .card h3{margin:4px 0 8px; font-size:16px;}
    .chart-toolbar{display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-bottom:6px;}
    .chart-wrap{position:relative; height:300px;}
    @media (min-width:768px){ .chart-wrap{height:360px;} }

    .sheet{position:fixed;left:0;right:0;bottom:-100%;background:#fff;border-top-left-radius:16px;border-top-right-radius:16px;box-shadow:0 -8px 24px rgba(0,0,0,.15);transition:bottom .25s ease;max-height:80vh;overflow:auto;padding:16px;border-top:1px solid var(--line);z-index:20}
    .sheet.open{bottom:0} .sheet .grab{width:44px;height:5px;border-radius:999px;background:#ddd;margin:0 auto 10px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
    .row label{font-size:14px}
    input[type="number"],select{width:8.5rem;padding:10px;border-radius:10px;border:1px solid var(--line);font-size:16px;background:#fff}

    .fabbar{position:fixed;left:0;right:0;bottom:0;z-index:15;background:rgba(255,255,255,.9);backdrop-filter:saturate(1.2) blur(6px);border-top:1px solid var(--line);padding:10px 16px;display:flex;gap:10px}
    .fabbar .btn{flex:1;font-weight:600}
    .overlay{position:fixed;inset:0;background:rgba(255,255,255,.7);display:none;align-items:center;justify-content:center;z-index:30;font-size:16px;color:#000}
    .overlay.show{display:flex}
    .spinner{width:28px;height:28px;border:3px solid #ddd;border-top-color:#12b886;border-radius:50%;animation:spin 1s linear infinite;margin-right:10px}@keyframes spin{to{transform:rotate(360deg)}}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:84px;z-index:40;background:#111;color:#fff;padding:10px 12px;border-radius:10px;font-size:14px;opacity:0;pointer-events:none;transition:opacity .2s ease}
    .toast.show{opacity:.96}
  </style>
</head>
<body>
  <header>
    <h1>ì‚¬ì´í´ë§ GPX ëª¨ë°”ì¼ ë¶„ì„ê¸°</h1>
    <div>
      <p>ìˆ˜ì •ì¼ì: 2025-08-08</p>
      <button id="openSheetBtn" class="btn">ì˜µì…˜</button>
    </div>
  </header>

  <div class="container">
    <div class="toolbar" style="margin-bottom:8px;">
      <input type="file" id="gpxFiles" accept=".gpx" multiple class="file-input" />
      <button id="addFilesBtn" type="button" class="btn primary">íŒŒì¼ ì¶”ê°€</button>
      <button id="clearFilesBtn" type="button" class="btn danger">ì´ˆê¸°í™”</button>
    </div>
    <div id="fileChips" aria-live="polite"></div>
    <div class="muted">ì—¬ëŸ¬ í´ë”ì—ì„œ ì—°ì† ì„ íƒí•˜ë ¤ë©´ <b>íŒŒì¼ ì¶”ê°€</b>ë¥¼ ì—¬ëŸ¬ ë²ˆ ëˆ„ë¥´ì„¸ìš”.</div>

    <div id="map" aria-label="í™œë™ ê²½ë¡œ ì§€ë„"></div>
    <div class="map-toolbar">
      <button id="togglePanBtn" class="btn ghost">ì§€ë„ ì´ë™: êº¼ì§</button>
      <select id="colorMode" class="btn">
        <option value="speed" selected>ì†ë„ ìƒ‰ìƒ</option>
        <option value="hr">ì‹¬ë°• ìƒ‰ìƒ</option>
        <option value="mono">ë‹¨ìƒ‰</option>
      </select>
    </div>

    <h2 style="margin-top:16px;">íŒŒì¼ë³„ ìš”ì•½</h2>
    <table id="summaryTable">
      <thead>
        <tr>
          <th class="left">íŒŒì¼</th>
          <th>í¬ì¸íŠ¸</th>
          <th>ê±°ë¦¬(km)</th>
          <th>ê²½ê³¼ì‹œê°„</th>
          <th>ì´ë™ì‹œê°„</th>
          <th>í‰ê· ì†ë„(ê²½ê³¼)</th>
          <th>í‰ê· ì†ë„(ì´ë™)</th>
          <th>ìµœëŒ€ì†ë„</th>
          <th>í‰ê· í˜ì´ìŠ¤</th>
          <th>ëˆ„ì ìƒìŠ¹</th>
          <th>í‰ê· ì‹¬ë°•</th>
          <th>ìµœëŒ€ì‹¬ë°•</th>
          <th>ì¹¼ë¡œë¦¬</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- ëˆ„ì  ì´ë™ê±°ë¦¬ ê·¸ë˜í”„ ì¹´ë“œ -->
    <div class="card" id="cumCard" style="display:none;">
      <div class="chart-toolbar">
        <label for="cumMode" class="muted">í‘œì‹œ: </label>
        <select id="cumMode" class="btn">
          <option value="file" selected>íŒŒì¼ë³„(ì¼ì+íŒŒì¼ëª…)</option>
          <option value="week">ì£¼ê°„(ISO ì£¼)</option>
          <option value="month">ì›”ê°„(YYYY-MM)</option>
        </select>
      </div>
      <h3>ğŸ“ˆ ëˆ„ì  ì´ë™ê±°ë¦¬</h3>
      <div class="chart-wrap">
        <canvas id="cumChart"></canvas>
      </div>
      <div class="muted" id="cumHint"></div>
    </div>

    <!-- ë©(1ê°œ íŒŒì¼ì¼ ë•Œë§Œ) -->
    <div id="lapsSection" style="display:none;">
      <h2 style="margin-top:16px;">ë©(ìŠ¤í”Œë¦¿)</h2>
      <table id="lapsTable">
        <thead>
          <tr>
            <th class="left">íŒŒì¼</th>
            <th>ë©</th>
            <th>êµ¬ê°„ê±°ë¦¬(km)</th>
            <th>êµ¬ê°„ì‹œê°„</th>
            <th>êµ¬ê°„í‰ê· ì†ë„</th>
            <th>êµ¬ê°„í˜ì´ìŠ¤</th>
            <th>êµ¬ê°„ìƒìŠ¹</th>
            <th>êµ¬ê°„í‰ê· ì‹¬ë°•</th>
            <th>êµ¬ê°„ì¹¼ë¡œë¦¬</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- ì˜µì…˜ ë°”í…€ì‹œíŠ¸ -->
  <div id="sheet" class="sheet" role="dialog" aria-modal="true" aria-labelledby="sheetTitle">
    <div class="grab"></div>
    <h3 id="sheetTitle" style="margin:4px 0 10px;">ë¶„ì„ ì˜µì…˜</h3>
    <div class="row">
      <label>ì´ë™ì„ê³„ì†ë„(m/s)
        <input type="number" id="movingThreshold" value="1.0" step="0.1" />
      </label>
      <label>ë© ê±°ë¦¬(km)
        <input type="number" id="lapDistanceKm" value="1" step="0.5" />
      </label>
    </div>
    <div class="row">
      <label>ê³ ë„ ìƒìŠ¹ ìµœì†Œ(m)
        <input type="number" id="minElevGain" value="1" step="0.5" />
      </label>
      <label>ì†ë„ ì´ìƒì¹˜ ìƒí•œ(km/h)
        <input type="number" id="maxSpeedCap" value="80" step="5" />
      </label>
    </div>
    <h4 style="margin:10px 0 0;">ì¹¼ë¡œë¦¬ ì˜µì…˜</h4>
    <div class="row">
      <label>ê³„ì‚° ë°©ì‹
        <select id="calorieMethod">
          <option value="auto" selected>Auto(íŒŒì¼ê°’â†’HRâ†’MET)</option>
          <option value="hr">HR ê¸°ë°˜(í‚¤í…”ì‹)</option>
          <option value="met">ì†ë„(MET) ê¸°ë°˜</option>
          <option value="none">ê³„ì‚° ì•ˆ í•¨</option>
        </select>
      </label>
      <label>ì²´ì¤‘(kg)
        <input type="number" id="weightKg" placeholder="ì˜ˆ: 70" step="0.1" />
      </label>
      <label>ë‚˜ì´
        <input type="number" id="age" placeholder="ì˜ˆ: 40" />
      </label>
      <label>ì„±ë³„
        <select id="sex">
          <option value="">ì„ íƒ</option>
          <option value="male">ë‚¨</option>
          <option value="female">ì—¬</option>
        </select>
      </label>
    </div>
    <div class="row" style="align-items:center;">
      <input type="checkbox" id="useSmoothElevation" checked />
      <label for="useSmoothElevation">ê³ ë„ ìŠ¤ë¬´ë”© ì‚¬ìš©(ê¶Œì¥)</label>
    </div>
    <div class="row" style="justify-content:flex-end;">
      <button id="closeSheetBtn" class="btn">ë‹«ê¸°</button>
    </div>
  </div>

  <!-- í•˜ë‹¨ ì•¡ì…˜ë°” / ì§„í–‰ ì˜¤ë²„ë ˆì´ / í† ìŠ¤íŠ¸ -->
  <div class="fabbar" role="group" aria-label="ê¸°ë³¸ ì‘ì—…">
    <button id="analyzeBtn" class="btn primary">ë¶„ì„</button>
    <button id="exportSummaryBtn" class="btn" disabled>ìš”ì•½ CSV</button>
    <button id="exportLapsBtn" class="btn" disabled>ë© CSV</button>
  </div>

  <div id="overlay" class="overlay" aria-live="polite">
    <div class="spinner"></div>
    <div><span id="progressText">ì²˜ë¦¬ ì¤‘â€¦</span></div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module" src="./gpx-mobile-ui.js"></script>
</body>
</html>

